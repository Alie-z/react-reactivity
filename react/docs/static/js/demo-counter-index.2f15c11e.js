(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{"./demo/counter/index.css":function(e,n,t){},"./demo/counter/index.mdx":function(e,n,t){"use strict";t.r(n),t.d(n,"default",(function(){return E}));var s=t("./node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties.js"),a=t("react"),r=t.n(a),o=t("./node_modules/@mdx-js/react/dist/esm.js"),c=t("./node_modules/antd/es/card/index.js"),u=t("./node_modules/antd/es/button/index.js"),i=t("./node_modules/antd/es/input/index.js"),l=t("./node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray.js"),m=t("./node_modules/@vue/reactivity/dist/reactivity.esm-bundler.js"),d=r.a.createContext(null),b=function(e){var n=Object(a.useContext)(d);if(!n)throw new Error("\u6ca1\u6709\u53d1\u73b0context\u7684value,\u8bf7\u5728\u7ec4\u4ef6\u4e0a\u4f7f\u7528<Provider>\u5305\u88f9\uff01");var t,s=Object(a.useReducer)((function(e){return e+1}),0),r=Object(l.a)(s,2)[1];t||(t=Object(m.b)((function(){return e(n)}),{lazy:!0,scheduler:function(e){void 0!==e()&&r()}})),Object(a.useEffect)((function(){return function(){return Object(m.e)(t)}}),[]);var o=t();for(var c in o)Object(m.c)(o[c])&&(o[c]=o[c].value);return o};b&&b===Object(b)&&Object.isExtensible(b)&&Object.defineProperty(b,"__filemeta",{enumerable:!0,configurable:!0,value:{name:"useStore",filename:"src\\index.js"}});var p=d.Provider;"undefined"!==typeof p&&p&&p===Object(p)&&Object.isExtensible(p)&&Object.defineProperty(p,"__filemeta",{enumerable:!0,configurable:!0,value:{name:"Provider",filename:"src\\index.js"}});var v=t("./node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js"),g=Object(m.d)({count:0,message:"Hello",msgList:[]});"undefined"!==typeof g&&g&&g===Object(g)&&Object.isExtensible(g)&&Object.defineProperty(g,"__filemeta",{enumerable:!0,configurable:!0,value:{name:"state",filename:"demo\\counter\\store.js"}});var f=Object(m.a)((function(){return g.count+1})),O=Object(m.a)((function(){return f.value*f.value}));Object(m.b)((function(){console.log("plusOne",f)}));var j={add:function(){return g.count+=1},setMsg:function(e){return g.message=e},sendMsg:function(e){return g.msgList=[].concat(Object(v.a)(g.msgList),[e])},delMsg1:function(e){var n=JSON.parse(JSON.stringify(g.msgList));n.splice(e,1),g.msgList=n},delMsg2:function(e){return g.msgList.splice(e,1)}};"undefined"!==typeof j&&j&&j===Object(j)&&Object.isExtensible(j)&&Object.defineProperty(j,"__filemeta",{enumerable:!0,configurable:!0,value:{name:"mutations",filename:"demo\\counter\\store.js"}});var h={state:g,computed:{plusOne:f,plusOneSquare:O}};"undefined"!==typeof h&&h&&h===Object(h)&&Object.isExtensible(h)&&Object.defineProperty(h,"__filemeta",{enumerable:!0,configurable:!0,value:{name:"store",filename:"demo\\counter\\store.js"}});t("./demo/counter/index.css"),t("./node_modules/antd/dist/antd.css");function x(){var e=b((function(e){var n=e.state,t=e.computed,s=t.plusOne,a=t.plusOneSquare;return{count:n.count,plusOne:s,plusOneSquare:a}}));return r.a.createElement(c.a,{hoverable:!0,style:{marginBottom:24}},r.a.createElement("h1",null,"\u8ba1\u6570\u5668"),r.a.createElement("div",{className:"chunk"},r.a.createElement("div",{className:"text-chunk"},"count: ",e.count),r.a.createElement("div",{className:"text-chunk"},"count\u52a0\u4e00: ",e.plusOne),r.a.createElement("div",{className:"text-chunk"},"count\u52a0\u4e00\u540e\u5e73\u65b9: ",e.plusOneSquare),r.a.createElement(u.a,{onClick:j.add},"add")))}function y(){var e=b((function(e){return e.state.message}));return r.a.createElement(c.a,{hoverable:!0,style:{marginBottom:24}},r.a.createElement("h1",null,"\u804a\u5929\u5ba4"),r.a.createElement("div",{className:"text-chunk"},"\u5f53\u524d\u6d88\u606f\u662f: ",e),r.a.createElement(i.a.Search,{placeholder:"\u8bf7\u8f93\u5165\u6d88\u606f",enterButton:"Send",size:"large",value:e,onChange:function(e){return j.setMsg(e.target.value)},onSearch:function(e){return function(e){j.setMsg(""),j.sendMsg(e)}(e)}}))}function S(){var e=b((function(e){return e.state.msgList.map((function(e,n){return r.a.createElement("div",{onClick:function(){return j.delMsg2(n)},key:n},e)}))}));return r.a.createElement(c.a,{hoverable:!0,style:{marginBottom:24}},r.a.createElement("h1",null,"\u6d88\u606f\u5217\u8868"),e)}var N=function(){return r.a.createElement(p,{value:h},r.a.createElement("div",{className:"flex"},r.a.createElement(x,null),r.a.createElement(y,null),r.a.createElement(S,null)))},C={};function E(e){var n=e.components,t=Object(s.a)(e,["components"]);return Object(o.b)("wrapper",Object.assign({},C,t,{components:n,mdxType:"MDXLayout"}),Object(o.b)("h2",{id:"\u7b80\u4ecb"},"\u7b80\u4ecb"),Object(o.b)("p",null,"\u4ec5\u4ec5\u9700\u8981\u4e00\u4e2a ",Object(o.b)("inlineCode",{parentName:"p"},"store")," \u6587\u4ef6\uff0c\u4f60\u5c31\u53ef\u4ee5\u5f00\u59cb\u7f16\u5199\u4f60\u7684\u6570\u636e\u4ed3\u5e93\u3002"),Object(o.b)("p",null,"\u672c\u5e93\u53ea\u63d0\u4f9b ",Object(o.b)("inlineCode",{parentName:"p"},"Provider")," \u548c ",Object(o.b)("inlineCode",{parentName:"p"},"useStore")," \u4e24\u4e2a api\uff0c\u914d\u5408 ",Object(o.b)("inlineCode",{parentName:"p"},"@vue/reactivity")," \u4ed3\u5e93\u91cc\u7684\u54cd\u5e94\u5f0f\u80fd\u529b\uff0c\u5373\u53ef\u5b8c\u6210\u4e00\u5207\u72b6\u6001\u7ba1\u7406\u3002"),Object(o.b)("h2",{id:"\u5b89\u88c5"},"\u5b89\u88c5"),Object(o.b)("pre",null,Object(o.b)("code",Object.assign({parentName:"pre"},{className:"language-JavaScript"}),"// yarn\nyarn add react-reactivity @vue/reactivity -S\n\n// npm\nnpm install react-reactivity @vue/reactivity -S\n\n")),Object(o.b)("h2",{id:"\u4f7f\u7528\u793a\u4f8b"},"\u4f7f\u7528\u793a\u4f8b"),Object(o.b)(N,{mdxType:"Counter"}),Object(o.b)("h2",{id:"store"},"Store"),Object(o.b)("pre",null,Object(o.b)("code",Object.assign({parentName:"pre"},{className:"language-JavaScript"}),"// store.js\nimport {reactive, effect, computed} from '@vue/reactivity'\n\nexport const state = reactive({\n  count: 0,\n  message: 'Hello',\n  msgList: []\n})\n\nconst plusOne = computed(() => state.count + 1);\nconst plusOneSquare = computed(() => plusOne.value * plusOne.value)\n\nconst add = () => state.count += 1\nconst setMsg = message => (state.message = message)\nconst sendMsg = msg => (state.msgList = [...state.msgList, msg])\nconst delMsg1 = index => {\n  const newMsg = JSON.parse(JSON.stringify(state.msgList))\n  newMsg.splice(index, 1)\n  state.msgList = newMsg\n}\nconst delMsg2 = index => state.msgList.splice(index, 1)\n\neffect(() => {\n  console.log('plusOne', plusOne)\n})\n\nexport const mutations = {\n  add,\n  setMsg,\n  sendMsg,\n  delMsg1,\n  delMsg2\n}\n\nexport const store = {\n  state,\n  computed: {\n    plusOne,\n    plusOneSquare\n  }\n}\n\n")),Object(o.b)("h2",{id:"codes"},"Codes"),Object(o.b)("pre",null,Object(o.b)("code",Object.assign({parentName:"pre"},{className:"language-JavaScript"}),'// index.js\nimport React from \'react\';\nimport {Card, Button, Input} from \'antd\';\nimport {Provider, useStore} from \'../../src\';\nimport {store, mutations} from \'./store\';\nimport \'./index.css\';\nimport \'antd/dist/antd.css\';\n\nfunction Count() {\n  const countState = useStore((store) => {\n    const {state, computed} = store\n    const {plusOne, plusOneSquare} = computed\n    return {\n      count: state.count,\n      plusOne,\n      plusOneSquare\n    }\n  });\n\n  return (\n    <Card hoverable style={{marginBottom: 24}}>\n      <h1>\u8ba1\u6570\u5668</h1>\n      <div className="chunk">\n        <div className="text-chunk">count: {countState.count}</div>\n        <div className="text-chunk">count\u52a0\u4e00: {countState.plusOne}</div>\n        <div className="text-chunk">count\u52a0\u4e00\u540e\u5e73\u65b9: {countState.plusOneSquare}</div>\n        <Button onClick={mutations.add}>add</Button>\n      </div>\n    </Card>\n  );\n}\n\nfunction Chat() {\n  const message = useStore((store) => store.state.message)\n\n  const _handleSend = msg => {\n    mutations.setMsg(\'\')\n    mutations.sendMsg(msg)\n  }\n  return (\n    <Card hoverable style={{marginBottom: 24}}>\n      <h1>\u804a\u5929\u5ba4</h1>\n      <div className="text-chunk">\u5f53\u524d\u6d88\u606f\u662f: {message}</div>\n      <Input.Search\n        placeholder="\u8bf7\u8f93\u5165\u6d88\u606f"\n        enterButton="Send"\n        size="large"\n        value={message}\n        onChange={v => mutations.setMsg(v.target.value)}\n        onSearch={(msg) => _handleSend(msg)}\n      />\n    </Card>\n  );\n}\n\n// function ViewArea() {\n//   const msgList = useStore(store => store.state.msgList)\n//\n//   return (\n//     <Card hoverable style={{marginBottom: 24}}>\n//       <h1>\u6d88\u606f\u5217\u8868</h1>\n//       {msgList.map((msg, i) => <div onClick={() => mutations.delMsg1(i)} key={i}>{msg}</div>)}\n//     </Card>\n//   )\n// }\n\nfunction ViewArea() {\n  const msgList = useStore((store) => {\n    return store.state.msgList.map((msg, i) => (\n      <div onClick={() => mutations.delMsg2(i)} key={i}>\n        {msg}\n      </div>\n    ));\n  });\n\n  return (\n    <Card hoverable style={{marginBottom: 24}}>\n      <h1>\u6d88\u606f\u5217\u8868</h1>\n      {msgList}\n    </Card>\n  )\n}\n\n\nexport default () => {\n  return (\n    <Provider value={store}>\n      <div className="flex">\n        <Count/>\n        <Chat/>\n        <ViewArea/>\n      </div>\n    </Provider>\n  );\n};\n\n')),Object(o.b)("h2",{id:"\u8fd0\u884c\u6d41\u7a0b"},"\u8fd0\u884c\u6d41\u7a0b"),Object(o.b)("ol",null,Object(o.b)("li",{parentName:"ol"},"\u901a\u8fc7@vue/reactivity\u5b9a\u4e49\u54cd\u5e94\u5f0fstate"),Object(o.b)("li",{parentName:"ol"},"\u5728\u7236\u7ec4\u4ef6\u901a\u8fc7Provider\u5c06store\u4f20\u9012\u4e0b\u53bb"),Object(o.b)("li",{parentName:"ol"},"\u5b50\u7ec4\u4ef6\u901a\u8fc7useStore\u4f20\u5165\u4e00\u4e2aschedule(store)\u65b9\u6cd5"),Object(o.b)("li",{parentName:"ol"},"react-reactivity\u5148\u901a\u8fc7useReducer\u5728\u5f53\u524d\u7ec4\u4ef6\u4e2d\u6ce8\u518c\u4e00\u4e2a\u5f3a\u5236\u66f4\u65b0\u7684\u51fd\u6570"),Object(o.b)("li",{parentName:"ol"},"\u901a\u8fc7useContext\u8bfb\u53d6\u7528\u6237\u4eceProvider\u4e2d\u4f20\u5165\u7684store"),Object(o.b)("li",{parentName:"ol"},"\u518d\u901a\u8fc7Vue\u7684effect\u53bb\u5e2e\u6211\u4eec\u6267\u884cselector(store)\uff0c\u5e76\u4e14\u6307\u5b9ascheduler\u4e3aforceUpdate\uff0c\u8fd9\u6837\u5c31\u5b8c\u6210\u4e86\u4f9d\u8d56\u6536\u96c6"),Object(o.b)("li",{parentName:"ol"},"\u54cd\u5e94\u5f0f\u6570\u636e\u66f4\u65b0\u540e\uff0c\u89e6\u53d1effect\u8c03\u7528forceUpdate\uff0c\u5b8c\u6210\u9875\u9762\u6e32\u67d3")))}E&&E===Object(E)&&Object.isExtensible(E)&&Object.defineProperty(E,"__filemeta",{enumerable:!0,configurable:!0,value:{name:"MDXContent",filename:"demo\\counter\\index.mdx"}}),E.isMDXComponent=!0}}]);